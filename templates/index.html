<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>WesmartAI 圖像封存展示</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container py-4">
  <h2 class="mb-3">WesmartAI × Together AI - Flux Schnell 測試介面</h2>

  <!-- Prompt 輸入區 -->
  <div class="mb-3">
    <label class="form-label">Prompt</label>
    <textarea id="prompt" class="form-control" rows="3"></textarea>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-4">
      <label class="form-label">Seed</label>
      <input type="number" id="seed" class="form-control" value="1234">
    </div>
    <div class="col-md-4">
      <label class="form-label">Steps</label>
      <input type="number" id="steps" class="form-control" value="8" max="20">
    </div>
  </div>

  <button class="btn btn-primary" onclick="generate()">生成圖像</button>

  <hr>

  <div id="results" class="row gy-4"></div>
</div>

<script>
let baseImageId = null;

function useAsBase(id) {
  baseImageId = id;
  alert(`已選擇此圖為基底（ID: ${id}），請在上方輸入新 Prompt 再生成。`);
}

async function generate() {
  const formData = new FormData();
  formData.append("prompt", document.getElementById("prompt").value);
  formData.append("seed", document.getElementById("seed").value);
  formData.append("steps", document.getElementById("steps").value);
  if (baseImageId) formData.append("base_image_id", baseImageId);

  const res = await fetch("/generate", {method: "POST", body: formData});
  const data = await res.json();
  if (data.error) return alert("生成失敗: " + data.error);

  const col = document.createElement("div");
  col.className = "col-md-4 text-center";
  col.innerHTML = `
    <img src="${data.image_url}" class="img-fluid rounded shadow-sm mb-2">
    <div class="small text-muted mb-2">Seed: ${data.seed}<br>Hash: ${data.hash.slice(0,16)}...</div>
    <button class="btn btn-outline-primary btn-sm" onclick="useAsBase('${data.image_id}')">
      以此為基底再生成
    </button>
  `;
  document.getElementById("results").prepend(col);
}
</script>
</body>
</html>
